---
description: 
globs: 
alwaysApply: true
---
# Plano de Migração para Arquitetura DDD (Domain-Driven Design)

## Objetivo

Migrar a HyperMusic-API para uma arquitetura baseada em DDD, promovendo maior clareza de domínio, escalabilidade, manutenibilidade e alinhamento com as melhores práticas de design de software.

---

## Fases da Migração

### 1. **Preparação e Alinhamento Conceitual**

- **Objetivos:**
  - Nivelar o entendimento da equipe sobre DDD (Bounded Context, Entities, Value Objects, Aggregates, Domain Services, Application Services, Infraestrutura).
  - Mapear os domínios e subdomínios do sistema.
  - Definir objetivos e critérios de sucesso da migração.
- **Entregáveis:**
  - Documento de conceitos DDD adaptados ao projeto.
  - Mapa dos domínios e contextos delimitados.
  - Critérios de sucesso e métricas de acompanhamento.

### 2. **Reorganização da Estrutura de Pastas**

- **Objetivos:**
  - Refatorar a estrutura de diretórios para refletir os domínios e camadas DDD.
  - Separar claramente camadas de domínio, aplicação e infraestrutura.
- **Entregáveis:**
  - Nova estrutura de pastas, por exemplo:

    ```
    src/
      ├── modules/
      │     ├── user/
      │     │     ├── domain/
      │     │     ├── application/
      │     │     ├── infrastructure/
      │     │     └── presentation/
      │     └── ...
      ├── shared/
      └── config/
    ```

  - Documentação da nova estrutura.

### 3. **Migração Incremental por Domínio**

- **Objetivos:**
  - Migrar um domínio de cada vez para o padrão DDD, começando pelo mais isolado (ex: Playlist).
  - Refatorar Models para Entities e Value Objects.
  - Criar Aggregates e Domain Services quando necessário.
  - Implementar Application Services para orquestração de casos de uso.
  - Adaptar repositórios para o padrão DDD.
- **Entregáveis:**
  - Domínio migrado com testes passando.
  - Documentação de decisões e padrões adotados.

### 4. **Adaptação dos Pontos de Entrada (Controllers/Routes)**

- **Objetivos:**
  - Adaptar controllers para chamar Application Services, não mais Services diretamente.
  - Garantir que a camada de apresentação não contenha lógica de domínio.
- **Entregáveis:**
  - Controllers refatorados.
  - Testes de integração validados.

### 5. **Infraestrutura e Integrações**

- **Objetivos:**
  - Adaptar integrações externas (DB, Redis, S3) para ficarem na camada de infraestrutura.
  - Garantir que o domínio não dependa de detalhes de infraestrutura.
- **Entregáveis:**
  - Adaptadores de infraestrutura implementados.
  - Testes de integração validados.

### 6. **Refino, Testes e Documentação**

- **Objetivos:**
  - Garantir cobertura de testes (unitários e integração).
  - Refatorar e documentar padrões, decisões e exemplos de uso.
  - Promover revisão de código e alinhamento final.
- **Entregáveis:**
  - Testes automatizados cobrindo regras de domínio e casos de uso.
  - Documentação final da arquitetura e exemplos de uso.

---

## Recomendações Gerais

- Migração incremental: evite big bang, priorize domínios menos acoplados.
- Refatore e teste a cada etapa, garantindo estabilidade.
- Documente decisões arquiteturais e padrões adotados.
- Promova alinhamento contínuo da equipe sobre conceitos DDD.
- Use Value Objects para regras e validações recorrentes.
- Separe claramente domínio (regra de negócio) de infraestrutura (banco, storage, etc).

---

## Exemplo de Estrutura DDD para um Domínio

```
src/modules/playlist/
  ├── domain/
  │     ├── entities/
  │     ├── value-objects/
  │     ├── services/
  │     └── repository.ts
  ├── application/
  │     ├── use-cases/
  │     └── dto/
  ├── infrastructure/
  │     ├── sequelize/
  │     └── adapters/
  └── presentation/
        ├── controllers/
        └── routes/
```

---

## Critérios de Sucesso

- Domínios migrados com regras de negócio encapsuladas.
- Baixo acoplamento entre domínio e infraestrutura.
- Facilidade de manutenção e evolução.
- Testes automatizados cobrindo regras de domínio.
- Documentação clara da arquitetura e decisões.

---

**Responsável:** Gabriel Henrique Finotti  
**Data de início:** [Preencher]  
**Previsão de conclusão:** [Preencher]
